## java 并发编程实践

#### [01 | 可见性、原子性和有序性问题：并发编程Bug的源头](https://time.geekbang.org/column/article/83682)

> 笔记

* 并发安全问题通常是由什么由什么引起的？-> 最终来看是数据结果和预期不一致的问题
    * 可见性 -> 一个线程对另外一个线程的修改是否可见
        * 多核cpu缓存(L1/L2)不一致引起线程不可见
    * 原子性 -> 单个或多个操作的执行不可中断，要么都成功，要么都失败
        * 有的指令不是原子的, 执行过程可以发生线程切换
        * 线程上下文切换导致cpu寄存器指令不一致
    * 有序性 -> 多条指令按顺序执行
        * 编译器优化，对指令进行重排，打破有序性
        * 指令重排后，可能引发例如线程拿到未初始化对象之类的问题
            * 如何查看java程序字节码？
                * javap -v xxx.class

* 什么情况下需要注意并发安全问题？
    * 共享变量
    * 发生check-and-do操作
    * 发生read-and-write操作
    * 集合，long型等操作（它们是非原子性操作的时候）
 
> 金句

**在采用一项技术的同时，一定要清楚它带来的问题是什么，以及如何规避**

举个例子，我们为了对系统实施监控，会引入例如pinpoint之类的AMP组件，解决了监控问题
的同时也带来了性能问题，比如对带宽的占用，增加了接口响应的延时等；再比如，微服务
架构是为了解决单体应用灵活性差等问题而出现，同时也带了了架构的复杂度，增加了服务
之间通信，数据隔离等问题。所以，一个技术在解决某个问题的同时可能带来新的问题，这样
我们可能又会为新的问题引入别的技术来处理，这是个不断循环的过程。因此，我们在评估
一项技术的时候，需要充分考虑其负面影响，怎么权衡利弊，实现利益最大化。



